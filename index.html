<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AppStore — Chrome Web Store Style</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
  <link rel="manifest" href="manifest.webmanifest">
  <style>
  :root {
    --bg: #f1f3f4;
    --panel: #ffffff;
    --accent: #1a73e8;
    --text: #202124;
    --subtext: #5f6368;
    --radius: 16px;
    --shadow: 0 1px 4px rgba(0,0,0,0.1);
    --shadow-hover: 0 6px 18px rgba(0,0,0,0.12);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: "Roboto", Arial, sans-serif;
  }
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--panel);
    border-bottom: 1px solid #dadce0;
    padding: 18px 26px;
  }
  .brand { display: flex; align-items: center; gap: 12px; }
  .brand-logo {
    font-size: 1.3rem;
    background: var(--accent);
    color: #fff;
    padding: 10px 14px;
    border-radius: 10px;
    font-weight: 600;
  }
  .search-bar {
    display: flex;
    align-items: center;
    background: #fff;
    padding: 8px 14px;
    border-radius: 24px;
    border: 1px solid #dadce0;
    gap: 8px;
  }
  .search-bar input { border:none; outline:none; font-size:0.95rem; }

  .categories {
    display: flex;
    gap: 12px;
    padding: 16px 26px;
    background: var(--panel);
    border-bottom: 1px solid #e0e0e0;
  }
  .categories button {
    padding: 8px 18px;
    border-radius: 20px;
    background: #e8eaed;
    border: none;
    cursor: pointer;
    color: var(--text);
  }
  .categories button.active { background: var(--accent); color: #fff; }

  .grid {
    padding: 30px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 26px;
  }

  .card {
    background: #fff;
    padding: 18px;
    border-radius: var(--radius);
    border: 1px solid #e0e0e0;
    box-shadow: var(--shadow);
    transition: 0.25s ease;
  }
  .card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-hover);
  }
  .app-icon {
    width: 52px;
    height: 52px;
    background: var(--accent);
    color: #fff;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    font-weight: 600;
  }

  .install-btn {
    margin-top: 12px;
    width: 100%;
    padding: 10px;
    border-radius: 22px;
    background: var(--accent);
    color: #fff;
    border: none;
    cursor: pointer;
  }

  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  .modal {
    background: #fff;
    padding: 26px;
    border-radius: var(--radius);
    width: 460px;
    box-shadow: var(--shadow-hover);
  }
  .modal-app-icon {
    width: 80px;
    height: 80px;
    border-radius: 18px;
    background: var(--accent);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.7rem;
    font-weight: 600;
  }
  .tag { background: #e8eaed; padding:4px 8px; border-radius:6px; font-size:0.75rem; }
  </style>
</head>
<body>

<header>
  <div class="brand">
    <div class="brand-logo">AS</div>
    <h1>AppStore</h1>
  </div>

  <div class="search-bar">
    <svg width="18" height="18" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><circle cx="11" cy="11" r="6"></circle><path d="M21 21l-4.3-4.3"></path></svg>
    <input id="q" placeholder="Search apps..." />
  </div>
</header>

<div class="categories">
  <button class="active" data-filter="all">All</button>
  <button data-filter="games">Games</button>
  <button data-filter="productivity">Productivity</button>
  <button data-filter="music">Music</button>
</div>

<main>
  <section id="grid" class="grid"></section>
  <div id="empty" style="display:none;text-align:center;color:var(--subtext);">No apps found.</div>
</main>

<div id="backdrop" class="modal-backdrop">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
      <span id="modal-category" class="tag">Category</span>
      <button id="close" style="border:none;background:none;font-size:1.2rem;cursor:pointer;">✕</button>
    </div>

    <div style="display:flex;gap:18px;align-items:flex-start;">
      <div>
        <div id="modal-icon" class="modal-app-icon">A</div>
      </div>
      <div>
        <h2 id="modal-title" style="margin:0 0 6px 0;">App Title</h2>
        <div style="display:flex;gap:10px;align-items:center;margin:6px 0;">
          <div id="modal-rating" class="rating">★ 4.8</div>
          <div id="modal-dev" class="app-dev">by Dev</div>
        </div>
        <p id="modal-desc">Description text</p>
        <div id="modal-tags" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:10px;"></div>
      </div>
    </div>

    <button id="install" class="install-btn" style="margin-top:20px;">Install</button>
  </div>
</div>

<script>
let APPS = [];
let CURRENT_APP = null;

async function loadApps() {
  let APPS = [];

  // Test fallback for apps.json if fetch fails
  try {
    const res = await fetch('apps.json');
    if (res.ok) {
      APPS = await res.json();
    } else {
      throw new Error('Fetch error');
    }
  } catch (err) {
    console.error('Fetching apps.json failed, using fallback data.');
    APPS = [
      {
        "id": 1,
        "title": "Test App",
        "dev": "Test Dev",
        "cat": "productivity",
        "rating": 4.5,
        "desc": "A test app for fallback.",
        "tags": ["test", "example"],
        "iconText": "TA",
        "color": "#7c3aed",
        "pwa": "/apps/test/index.html"
      }
    ];
  }
  renderApps();
}

const grid = document.getElementById('grid');
const empty = document.getElementById('empty');
const search = document.getElementById('q');
let currentFilter = 'all';

function renderApps() {
  grid.innerHTML = '';
  const q = search.value.toLowerCase();

  const list = APPS.filter(app =>
    (currentFilter === 'all' || app.cat === currentFilter) &&
    (app.title.toLowerCase().includes(q) || app.dev.toLowerCase().includes(q))
  );

  if (!list.length) {
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  list.forEach(app => {
    const card = document.createElement('div');
    card.className = 'card';

    card.innerHTML = `
      <div class="app-icon" style="background:${app.color}">${app.iconText}</div>
      <div class="app-title">${app.title}</div>
      <div class="app-dev">by ${app.dev}</div>
      <div class="rating">★ ${app.rating}</div>
      <button class="install-btn">View</button>
    `;

    card.querySelector('.install-btn').addEventListener('click', () => openModal(app));
    grid.appendChild(card);
  });
}

search.addEventListener('input', renderApps);

document.querySelectorAll('.categories button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelector('.categories .active')?.classList.remove('active');
    btn.classList.add('active');
    currentFilter = btn.dataset.filter;
    renderApps();
  });
